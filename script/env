#!/bin/bash

set -euo pipefail

SITE_BRANCH="${SITE_BRANCH:-${TRAVIS_BRANCH:-$(git rev-parse --abbrev-ref HEAD)}}"
SITE_COMMIT="${SITE_COMMIT:-${TRAVIS_COMMIT_MESSAGE:-$(git log -1 --oneline --no-decorate)}}"
SITE_VERSION="${SITE_VERSION:-${TRAVIS_COMMIT:-$(git rev-parse HEAD)}}"

if [[ $NODE_ENV == "development" ]]; then
  default_env=development
  default_url=http://localhost:8000
elif [[ $SITE_BRANCH == "stable" ]]; then
  default_env=production
  default_url=http://docwhat.org
else
  default_env=staging
  default_url=http://next.docwhat.org
fi

GATSBY_ENV="${GATSBY_ENV:-${default_env}}"
GATSBY_URL="${GATSBY_URL:-${default_url}}"

export SITE_BRANCH SITE_COMMIT SITE_VERSION GATSBY_ENV GATSBY_URL

exec "$@"

# EOF
