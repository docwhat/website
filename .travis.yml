sudo: required
language: node_js
node_js:
  - "10"
cache:
  directories:
    - node_modules
    - ~/.cache
  yarn: true
services:
  - docker
env:
  global:
    - DOCKER_BUILDKIT=1
    - DOCKER_USERNAME=docwhat
    - secure: H15XDKoyFzVdeciTVddgJiWm6LYPUeFLDwODj2pMqZJ7DgvtlL1HL+y/g/csQ+0a1MbH83Mn64opEih2s62W4q4F+Uea948FoDfPLIbwqO/ilfqPuR4+r3ZV4axPwOsEpdv0Od3IanN+2f5I0wHe4Ioh0bJbvW9EiQUyaDvgMZU=
    - secure: Tu9PBkOV1FOewm0PBxN1XfGnfvlnr2qysXIegiMcoQGrR6qcIGn2J2ZoXbcIdOpVU0xwty8eLQCPj/oamBUYX6D2h5fbu+puRs7UB81Y1t5RzNc6Y7XqjagGLni2HbDSltKdNDQydtA1Nuz1ugsZNm9G2+jc54En4SM5dgKBaxA=

install: true nop
before_script:
  - sudo apt-get install -y pigz

script:
  - yarn run travis

deploy:
  skip_cleanup: true
  provider: script
  script: 'script/push "${TRAVIS_BRANCH}"'
  on:
    all_branches: true
    condition: $TRAVIS_BRANCH =~ ^master|stable$

notifications:
  email:
    on_failure: never
    on_success: never
  pushover:
    api_key:
      secure: diUwJTJM8+LfgSJDt5dba6iXlAH01/3bIOSj622mT4zNix91e2W00mleN0C1HaoQoOJ6JaMgQLUOqxmy1spqUbVs4sHpdTxcCaK9jF5Z/OslxRk7BGnLzaJYIKDUqoqPLWtkdFzrdrGAw5pHp3ZoQpNNxDn87R76b+43F2rPKpI=
    on_failure: always
    on_success: change
    template:
      - "%{result}: %{commit_subject}"
      - "  %{compare_url}"
      - "  %{build_url}"
    users:
      secure: QFycDr2Xncye5QsFFHJs7nSd2sek0ntb7d/PthDAGkpxrfW9ebqkvrpjGSBDQiytqTBKOiUOkKwAFFNz7csukCdZ1mdjgQNoKmTzIgQvakUjZUsLZC/rPGHMveRdoaCNgiUwxWIRUCxpAHtlOFiYEdeJFuO5ju4vgmYP0gF/hXY=
  webhooks: https://www.travisbuddy.com/
